<form	class="{{cssClass}} flexcol{{#if flags.inline-secrets}} inline-secrets{{/if}}{{#if flags.hidden-secrets}} hidden-secrets{{/if}}{{#if flags.editing}} editing{{/if}}" 
		autocomplete="off"
		style="--list-seperator: '{{ localize 'MOBLOKS5E.Comma' }}'; --list-conjuntion: '{{ localize 'MOBLOKS5E.ListFinalConjunctionAnd' }}'; "
	>
	{{#if owner}}
	<nav class="switches">
		<i class="fas fa-cog"></i>
		<ul>
			<li>
				<a class="trigger" data-control="switchToDefault">{{ localize "MOBLOKS5E.SwitchToDefault" }}</a>
			</li>
			<li>
				<a class="switch" data-control="editing">
					{{~#if flags.editing}}
						{{~ localize "MOBLOKS5E.DisableEdit" ~}}
					{{~else}}
						{{~ localize "MOBLOKS5E.EnableEdit" ~}}
					{{~/if~}}
				</a>
			</li>
			{{#if flags.editing}}
			<li>
				<a class="switch" data-control="show-delete">
					{{~#if flags.show-delete}}
						{{~ localize "MOBLOKS5E.DisableDelete" ~}}
					{{~else}}
						{{~ localize "MOBLOKS5E.EnableDelete" ~}}
					{{~/if~}}
				</a>
			</li>
			{{/if}}
			<li>
				<a class="switch" data-control="show-resources">
					{{~#if flags.show-resources}}
						{{~ localize "MOBLOKS5E.HideResources" ~}}
					{{~else}}
						{{~ localize "MOBLOKS5E.ShowResources" ~}}
					{{~/if~}}
				</a>
			</li>
			<li>
				<a class="switch" data-control="show-skill-save">
					{{~#if flags.show-skill-save}}
					{{~ localize "MOBLOKS5E.HideSkillSave" ~}}
					{{~else}}
					{{~ localize "MOBLOKS5E.ShowSkillSave" ~}}
					{{~/if~}}
				</a>
			</li>
			<li>
				<a class="switch" data-control="show-not-prof">
					{{~#if flags.show-not-prof}}
						{{~ localize "MOBLOKS5E.HideNotProf" ~}}
					{{~else}}
						{{~ localize "MOBLOKS5E.ShowNotProf" ~}}
					{{~/if~}}
				</a>
			</li>
			<li>
				<a class="switch" data-control="attack-descriptions">{{ localize "MOBLOKS5E.AttackDescriptions" }}</a>
				<ul>
					<li>
						<a class="switch" data-control="attack-descriptions">
							{{~#if flags.attack-descriptions}}
								{{~ localize "MOBLOKS5E.HideGenerated" ~}}
							{{~else}}
								{{~ localize "MOBLOKS5E.ShowGenerated" ~}}
							{{~/if~}}
						</a>
					</li>
				</ul>
			</li>
			{{#if info.hasCastingFeature}}
			<li>
				<a class="switch" data-control="casting-feature">{{ localize "DND5E.Spellcasting" }}</a>
				<ul>
					<li>
						<a class="switch" data-control="casting-feature">
							{{~#if flags.casting-feature~}}
								{{~ localize "MOBLOKS5E.HideGenerated" ~}}
							{{~else~}}
								{{~ localize "MOBLOKS5E.ShowGenerated" ~}}
							{{~/if~}}
						</a>
					</li>
				</ul>
			</li>
			{{/if}}
			<li>
				<a>{{ localize "MOBLOKS5E.DescriptionS" }}</a>
				<ul>
					<li>
						<a class="switch" data-control="inline-secrets">
							{{~#if flags.inline-secrets~}}
								{{~ localize "MOBLOKS5E.DisableInlSecr" ~}}
							{{~else~}}
								{{~ localize "MOBLOKS5E.EnableInlSecr" ~}}
							{{~/if~}}
						</a>
					</li>
					<li>
						<a class="switch" data-control="hidden-secrets">
							{{~#if flags.hidden-secrets~}}
								{{~ localize "MOBLOKS5E.ShowSecrets" ~}}
							{{~else~}}
								{{~ localize "MOBLOKS5E.HideSecrets" ~}}
							{{~/if~}}
						</a>
					</li>
				</ul>
			</li>
			<li>
				<a>{{ localize "DND5E.HitPoints" }}</a>
				<ul>
					<li>
						<a class="switch" data-control="current-hit-points">
							{{~#if flags.current-hit-points~}}
								{{~ localize "MOBLOKS5E.HideCurrentHP" ~}}
							{{~else~}}
								{{~ localize "MOBLOKS5E.ShowCurrentHP" ~}}
							{{~/if~}}
						</a>
					</li>
					<li>
						<a class="switch" data-control="maximum-hit-points">
							{{~#if flags.maximum-hit-points~}}
								{{~ localize "MOBLOKS5E.HideMaxHP" ~}}
							{{~else~}}
								{{~ localize "MOBLOKS5E.ShowMaxHP" ~}}
							{{~/if~}}
						</a>
					</li>
				</ul>
			</li>
			<li>
				<a class="switch" data-control="hide-profile-image">
					{{~#if flags.hide-profile-image~}}
						{{ localize "MOBLOKS5E.ShowProfileImage" ~}}
					{{~else~}}
						{{ localize "MOBLOKS5E.HideProfileImage" ~}}
					{{~/if~}}
				</a>
			</li>
			{{#if info.hasLair}}
			<li>
				<a class="switch" data-control="show-lair-actions">
					{{~#if flags.show-lair-actions~}}
						{{ localize "MOBLOKS5E.HideLair" ~}}
					{{~else~}}
						{{ localize "MOBLOKS5E.ShowLair" ~}}
					{{~/if~}}
				</a>
			</li>
			{{/if}}
			<li>
				<a class="switch" data-control="show-bio">
					{{~#if flags.show-bio~}}
						{{ localize "MOBLOKS5E.HideBio" ~}}
					{{~else~}}
						{{ localize "MOBLOKS5E.ShowBio" ~}}
					{{~/if~}}
				</a>
			</li>
			{{#if info.vttatokenizer}}
			<li>
				<a class="trigger" data-control="openTokenizer">{{ localize "MOBLOKS5E.OpenTokenizer" }}</a>
			</li>
			{{/if}}
			<li>
				<a class="trigger" data-control="resetDefaults">{{ localize "MOBLOKS5E.resetDefaults.label" }}</a>
			</li>
			<li>
				<a>{{localize "MOBLOKS5E.mini-block.label"}}</a>
				<ul>
					<li>
						<a class="switch" data-control="compact-window">
							{{~#if flags.compact-window}}
								{{~ localize "MOBLOKS5E.compact-window.disable" ~}}
							{{~else}}
								{{~ localize "MOBLOKS5E.compact-window.enable" ~}}
							{{~/if~}}
						</a>
					</li>
					<li>
						<a class="switch" data-control="compact-layout">
							{{~#if flags.compact-layout}}
								{{~ localize "MOBLOKS5E.compact-layout.disable" ~}}
							{{~else}}
								{{~ localize "MOBLOKS5E.compact-layout.enable" ~}}
							{{~/if~}}
						</a>
					</li>
					<li>
						<a class="switch" data-control="compact-feats">
							{{~#if flags.compact-feats}}
								{{~ localize "MOBLOKS5E.compact-feats.disable" ~}}
							{{~else}}
								{{~ localize "MOBLOKS5E.compact-feats.enable" ~}}
							{{~/if~}}
						</a>
					</li>
					<li>		
						<label>
							<a class="trigger nochild" data-control="setFontSize">
								{{~ localize "MOBLOKS5E.font-size.label" }}{{ localize "MOBLOKS5E.Colon" ~}}
							</a>
							<input type="text" class="switch-input" placeholder="{{localize "MOBLOKS5E.font-size.placeholder"}}" value="{{flags.font-size}}">
						</label>
					</li>
				</ul>
			</li>
			<li>
				<a>{{ localize "MOBLOKS5E.Theme" }}</a>
				<ul>
				{{#each themes as |theme id|}}
				{{#unless (eq id "custom")}}
					<li>
						<a	class="trigger{{#if (eq @root.flags.theme-choice id)}} selected{{/if}}"
							data-control="pickTheme" 
							data-value="{{id}}">
							{{~ localize theme.name ~}}
						</a>
					</li>
				{{/unless}}
				{{/each}}
					<li>
						<label class="custom-class-label{{#if (eq flags.theme-choice 'custom')}} selected{{/if}}">
							<a	class="trigger nochild" 
								data-control="pickTheme" 
								data-value="custom">
								{{~ localize "MOBLOKS5E.CustomThemeName" }}{{ localize "MOBLOKS5E.Colon" ~}}
							</a>
							<input type="text" class="switch-input" placeholder="class-name" value="{{flags.custom-theme-class}}">
						</label>
					</li>
				</ul>
			</li>
		</ul>
	</nav>
	{{/if}}
{{#if flags.show-bio}}
	<header class="sheet-header">
		<h1 class="charname" contenteditable="{{flags.editing}}" data-field-key="name"
			placeholder="{{ localize 'DND5E.Name' }}">{{actor.name}}</h1>
		{{#unless flags.hide-profile-image}}
			<figure class="profile-image">
				<img src="{{actor.img}}" data-edit="img"
					title="{{actor.name}} - {{ localize "MOBLOKS5E.EditHint" }}">
			</figure>
		{{/unless}}
	</header>
	<main class="bio-box">
		<h4 class="attribute-name source">{{ localize "DND5E.Source" }}:</h4>
		<span  contenteditable="{{flags.editing}}" data-field-key="data.details.source"
			placeholder="{{ localize 'DND5E.Source' }}">{{data.details.source}}</span>
		<h2 class="section-header">{{ localize "DND5E.Biography" }}</h2>
		<section class="biography active">
			{{editor content=data.details.biography.value target="data.details.biography.value" button=(and owner flags.editing) owner=owner editable=flags.editing}}
		</section>
	</main>
{{else}}
	<header class="sheet-header{{#unless flags.hide-profile-image}} image-enabled{{/unless}}">
		<section class="monster-identity">
			<h1 class="charname" contenteditable="{{flags.editing}}" data-field-key="name" placeholder="{{ localize 'DND5E.Name' }}">{{actor.name}}</h1>
			<div class="chartype">
				<div class="select-field" data-select-key="data.traits.size" data-selected-value="{{data.traits.size}}">
					<label class="{{#if flags.editing}}select-label{{/if}}">{{ lookup config.actorSizes data.traits.size}}</label>{{~" "~}}
					{{#if flags.editing~}}
						<ul class="actor-size select-list">
							{{#each config.actorSizes as |label size|}}
							{{#unless (eq size ../data.traits.size)}}
								<li data-selection-value="{{size}}">{{label}}</li>
							{{/unless}}
							{{~/each~}}
						</ul>
					{{~/if~}}
				</div>{{~" "~}}
				<span class="optional-space" contenteditable="{{flags.editing}}" data-field-key="data.details.type" placeholder="{{ localize 'DND5E.Type' }}">
					{{~data.details.type~}}
				</span>{{~" "~}}
				<span class="optional-comma" contenteditable="{{flags.editing}}" placeholder="{{ localize 'DND5E.Alignment' }}" data-field-key="data.details.alignment">
					{{~data.details.alignment~}}
				</span>
			</div>
			{{#unless flags.hide-profile-image}}
				<figure class="profile-image">
					<img src="{{actor.img}}" data-edit="img"
						title="{{actor.name}} - {{ localize "MOBLOKS5E.EditHint" }}">
				</figure>
			{{/unless}}
		</section>
		<section class="monster-attributes1">
			<ul class="attributes">
				<li class="attribute">
					<span class="attribute-wrapper">
						<h4 class="attribute-name box-title">{{ localize "DND5E.ArmorClass" }}</h4>
						<span class="attr-value" data-field-key="data.attributes.ac.value" data-dtype="Number" placeholder="{{ localize 'DND5E.ArmorClass' }}" contenteditable="{{flags.editing}}">{{data.attributes.ac.value}}</span>
					</span>
				</li>
				<li class="attribute health">
					<h4 class="attribute-name box-title">
						<a class="trigger" data-control="_onRollHPFormula">
							{{~localize "DND5E.HitPoints" }} 
						</a>
					</h4>
					{{~#unless (or flags.current-hit-points flags.maximum-hit-points)~}}
						<span title="{{ localize 'MOBLOKS5E.Average' }}" class="attr-value">{{data.attributes.hp.average}}</span>
					{{~/unless~}}
					{{#if flags.current-hit-points}}
						<span title="{{ localize 'MOBLOKS5E.Current' }}" 
							placeholder="0" 
							data-field-key="data.attributes.hp.value" 
							data-dtype="Number" 
							class="attr-value" 
							contenteditable="{{owner}}">
							{{~#if data.attributes.hp.value~}}
								{{~data.attributes.hp.value~}}
							{{~else~}}
								0
							{{~/if~}}
						</span>
					{{~/if~}}
					{{~#if (and flags.current-hit-points flags.maximum-hit-points)~}}
						<span class="sep"> / </span>
					{{~/if~}}
					{{~#if flags.maximum-hit-points~}}
						<span title="{{ localize 'MOBLOKS5E.Maximum' }}" 
							placeholder="0" 
							data-field-key="data.attributes.hp.max" 
							data-dtype="Number"
							class="attr-value" 
							contenteditable="{{owner}}">
							{{~#if data.attributes.hp.max~}}
								{{data.attributes.hp.max~}}
							{{~else~}}
								0
							{{~/if~}}
						</span>
					{{/if}}
					
					(<span title="Average: {{data.attributes.hp.average}}"
						placeholder="1d6"
						data-field-key="data.attributes.hp.formula"
						data-dtype="Roll"
						class="attr-value"
						contenteditable="{{flags.editing}}">
							{{~data.attributes.hp.formula~}}
					</span>)
				</li>
				<li class="attribute">
					<span class="attribute-wrapper">
						<h4 class="attribute-name box-title">{{ localize "DND5E.Speed" }}</h4>
						{{#each movement as |move|~}}
							<span class="editable-wrapper{{#if (and move.value @index)}} optional-comma{{/if}}">
								{{~#if (and move.value move.showLabel)}}{{move.label}} {{/if~}}
								<span class="attr-value" 
									contenteditable="{{../flags.editing}}"
									placeholder="&nbsp;{{move.label}}"
									data-field-key="{{move.key}}"
									data-dtype="Number">
									{{~move.value~}}
								</span>
								{{~#if move.value}} {{move.unit}}{{/if~}}
								{{~#if move.fly~}}
									<span class="hover-only no-break nocaps">
										(<span class="toggle-button" data-toggle-key="data.attributes.movement.hover"
											data-toggle-value="{{../data.attributes.movement.hover}}">
											{{~#if ../data.attributes.movement.hover~}}
												<i class="fas fa-check"></i>
											{{~else~}}
												<i class="far fa-circle"></i>
											{{~/if}}
											{{ localize "DND5E.MovementHover" ~}}
										</span>){{~" "~}}
									</span>
								{{~/if~}}
							</span>
						{{~/each}}
						<div class="hover-only select-field" data-select-key="data.attributes.movement.units" data-selected-value="{{data.attributes.movement.units}}">
							<label
								class="{{#if flags.editing}}select-label{{/if}}">{{ lookup config.movementUnits data.attributes.movement.units}}</label>{{~" "~}}
								{{#if flags.editing~}}
									<ul class="actor-size select-list">
										{{#each config.movementUnits as |label unit|}}
											{{#unless (eq unit ../data.attributes.movement.units)}}
												<li data-selection-value="{{unit}}">{{label}}</li>
											{{/unless}}
										{{~/each~}}
									</ul>
								{{~/if~}}
						</div>
					</span>
                </li>
			</ul>
		</section>
		<section class="monster-abilities">
			<ul class="ability-scores flexrow">
            {{#each data.abilities as |ability id|}}
                <li class="ability{{#if ability.proficient}} proficient{{/if}}" data-ability="{{id}}">
                    <h4 class="ability-title box-title" title="{{ability.label}}">{{ability.abbr}}</h4>
					<span class="attr-value"
						contenteditable="{{@root.flags.editing}}"
						placeholder="0"
						data-field-key="data.abilities.{{id}}.value"
						data-dtype="Number"
						title="{{ localize 'MOBLOKS5E.Score' }}">
						{{~ability.value~}}
					</span>
					<span class="ability-modifier" title="{{ localize 'MOBLOKS5E.Modifier' }}">({{numberFormat ability.mod decimals=0 sign=true}})</span>
                </li>
            {{/each}}
            </ul>
		</section>
		{{#*inline "menuItem"}}
		{{#with item}}
			{{#if (or (eq type "root-menu") (eq type "sub-menu"))}}
				{{! If this is a root-menu, wrap it with a figure, otherwise it's a sub-menu so it's wrapped with an li}}
				< {{~#if (eq type "root-menu")~}}
					figure class="menu tweak-menu
				{{~else~}}
					li class="menu sub-menu
				{{~/if}}
					{{~#if visible}} menu-open{{/if}}">
					<label class="menu-toggle" data-menu-id="{{id}}">{{{label}}}</label>
					{{~#if (eq type "root-menu")}}<div class="overflow-fix">{{/if}}
						<ul>
							{{~#each children~}}
								{{> menuItem item=this}}
							{{~/each~}}
						</ul>
					{{~#if (eq type "root-menu")}}</div>{{/if}}
				</{{#if (eq type "root-menu")}}figure{{else}}li{{/if}}>
			{{/if}}
			{{#if (eq type "skill")}}
				<li>
					<labal title="{{skill.hover}}">
						<a class="proficiency-toggle skill-proficiency" data-skill-id="{{id}}" data-skill-value="{{skill.value}}">
							<span class="menu-item-icon">{{{skill.icon}}}</span>{{~" "~}}
							<span class="skill-label">{{skill.label}}</span>
							<span class="skill-ability">{{skill.abilityAbbr}}</span>
						</a>
					</label>
				</li>
			{{/if}}
			{{#if (or (eq type "save-toggle") (eq type "damage-type") (eq type "condition-type") (eq type "language-opt"))}}
				<li>
					<a data-option="{{d}}"
						data-{{type}}="{{target}}"
						data-flag="{{flag}}">
						<span class="menu-item-icon">{{{icon}}}</span>{{~" "~}}
						<span class="trait-sel-label">{{name}}</span>
					</a>
				</li>
			{{/if}}
			{{#if (eq type "custom-val")}}
				<li class="custom-trait">
					<label for="{{target}}">
						<span class="trait-sel-label">{{name}}</span>
						<input 
							type="text" 
							name="{{target}}"
							value="{{value}}">
					</label>
				</li>
			{{/if}}
			{{#if (eq type "trigger")}}
				<li>
					<a class="trigger" data-control="{{control}}"
						{{#each data as |dat id|}}
							data-{{id}}="{{dat}}"
						{{/each}}
						>
						<span class="menu-item-icon">{{{icon}}}</span>{{~" "~}}
						<span class="trigger-lable">{{label}}</span>
					</a>
				</li>
			{{/if}}
		{{/with}}
		{{/inline}}
		<section class="monster-attributes2{{#if menus.attributes.visible}} menu-active{{/if}}">
			{{#if flags.editing}}
				{{> menuItem item=menus.attributes}}
			{{/if}}

			<ul class="attributes">
				{{#if (or info.hasSaveProfs flags.show-not-prof flags.show-skill-save)}}
				<li class="monster-saves attribute">
					<span class="attrbute-wrapper">
						<figure class="menu simple-menu">
							<h4 class="attribute-name menu-toggle" data-menu-id="save-roller">{{ localize "MOBLOKS5E.SavingThrowS" }}</h4>
							<div class="overflow-fix">
								<ul>
								{{#each data.abilities as |ability id|}}
									<li class="saving-throw {{#if ability.proficient}}proficient{{/if}}" data-ability="{{id}}"
										title="{{ability.label}}">
										<span class="ability-title">{{ability.label}}</span>
										<span>{{numberFormat ability.save decimals=0 sign=true}}</span>{{~" "~}}
									</li>
								{{/each}}
								</ul>
							</div>
						</figure>
						<ul class="inline-list">
						{{#each data.abilities as |ability id|}}
						{{#if (or ability.proficient @root.flags.show-not-prof)}}
							<li class="saving-throw {{#if ability.proficient}}proficient{{/if}}" data-ability="{{id}}" title="{{ability.label}}">
								<span class="ability-title">{{ability.abbr}}</span>
								<span>{{numberFormat ability.save decimals=0 sign=true}}</span>{{~" "~}}
							</li>
						{{/if}}
						{{/each}}
							{{#unless info.hasSaveProfs}}<li>&mdash;</li>{{/unless}}
						</ul>
					</span>
				</li>
				{{/if}}
				{{#if (or info.hasSkills flags.show-not-prof flags.show-skill-save)}}
				<li class="monster-skills attribute">
					<span class="attribute-wrapper">
						<figure class="menu simple-menu">
							<h4 class="attribute-name menu-toggle" data-menu-id="skill-roller">{{ localize "MOBLOKS5E.SkillS" }}</h4>
							<div class="overflow-fix">
								<ul>
								{{#each data.skills as |skill s|}}
									<li class="skill {{#if skill.value}}proficient{{/if}}" title="{{skill.ability}}" data-skill="{{s}}">
										<span class="skill-title">{{skill.label}}</span>
										<span class="skill-mod">{{numberFormat skill.total decimals=0 sign=true}}</span>{{~" "~}}
									</li>
								{{/each}}
								</ul>
							</div>
						</figure>
						<ul class="inline-list">
						{{#each data.skills as |skill s|}}
						{{#if (or skill.value @root.flags.show-not-prof)}}
							<li class="skill {{#if skill.value}}proficient{{/if}}"  title="{{skill.ability}}" data-skill="{{s}}">
								<span class="skill-title">{{skill.label}}</span>
								<span class="skill-mod">{{numberFormat skill.total decimals=0 sign=true}}</span>{{~" "~}}
							</li>
						{{/if}}
						{{/each}}
							{{#unless info.hasSkills}}<li>&mdash;</li>{{/unless}}
						</ul>
					</span>
				</li>
				{{/if}}
				{{#if (moblok-hascontents data.traits.dv.selected)}}
				<li class="attribute">
					<span class="attribute-wrapper">
						<h4 class="attribute-name">{{localize "DND5E.DamVuln"}}</h4>
						<ul class="traits-list inline-list no-caps">
						{{#each data.traits.dv.selected as |v k|}}
							<li class="trait-value">{{v}}</li>
						{{/each}}
						</ul>
					</span>
				</li>
				{{/if}}
				{{#if (moblok-hascontents data.traits.dr.selected)}}
				<li class="attribute">
					<span class="attribute-wrapper">
						<h4 class="attribute-name">{{localize "DND5E.DamRes"}}</h4>
						<ul class="traits-list inline-list no-caps">
						{{#each data.traits.dr.selected as |v k|}}
							<li class="trait-value">{{v}}</li>
						{{/each}}
						</ul>
					</span>
				</li>
				{{/if}}
				{{#if (moblok-hascontents data.traits.di.selected)}}
				<li class="attribute">
					<span class="attribute-wrapper">
						<h4 class="attribute-name">{{localize "DND5E.DamImm"}}</h4>
						<ul class="traits-list inline-list no-caps">
						{{#each data.traits.di.selected as |v k|}}
							<li class="trait-value">{{v}}</li>
						{{/each}}
						</ul>
					</span>
				</li>
				{{/if}}
				{{#if (moblok-hascontents data.traits.ci.selected)}}
				<li class="attribute">
					<span class="attribute-wrapper">
						<h4 class="attribute-name">{{localize "DND5E.ConImm"}}</h4>
						<ul class="traits-list inline-list no-caps">
						{{#each data.traits.ci.selected as |v k|}}
							<li class="trait-value">{{v}}</li>
						{{/each}}
						</ul>
					</span>
				</li>
				{{/if}}
				<li class="attribute">
					<span class="attribute-wrapper">
						<h4 class="attribute-name">{{localize "DND5E.Senses"}}</h4>
						{{#each senses as |sense|~}}
							<span class="editable-wrapper">
								{{~#if sense.value}}{{sense.label}} {{/if~}}
								<span class="attr-value" contenteditable="{{../flags.editing}}" placeholder="{{sense.label}}&nbsp;"
									data-field-key="{{sense.key}}" data-dtype="Number">
									{{~sense.value~}}
								</span>
								{{~#if sense.value}} {{sense.unit}}{{/if~}}
							</span>
							{{~#if sense.value}}{{localize "MOBLOKS5E.Comma"}} {{/if~}}
						{{~/each~}}
						<span class="editable-wrapper">{{~" "~}}
							<span class="attr-value" contenteditable="{{flags.editing}}" placeholder="{{specialSenses.special.label}}&nbsp;"
								data-field-key="{{specialSenses.special.key}}">
								{{~specialSenses.special.value~}}
							</span>{{~" "~}}
						</span>
						{{~#if specialSenses.special.value}}{{localize "MOBLOKS5E.Comma"}} {{/if~}}
						<span>
							{{~specialSenses.passivePerception~}}
						</span>
						<div class="hover-only select-field" data-select-key="data.attributes.senses.units"
							data-selected-value="{{data.attributes.senses.units}}">
							<label
								class="{{#if flags.editing}}select-label{{/if}}">{{ lookup config.movementUnits data.attributes.senses.units}}</label>{{~" "~}}
								{{#if flags.editing~}}
								<ul class="actor-size select-list">
									{{#each config.movementUnits as |label unit|}}
										{{#unless (eq unit ../data.attributes.senses.units)}}
											<li data-selection-value="{{unit}}">{{label}}</li>
										{{/unless}}
									{{~/each~}}
								</ul>
								{{~/if~}}
						</div>
					</span>
				</li>
				
				<li class="attribute">
					<span class="attribute-wrapper">
						<h4 class="attribute-name">{{localize "DND5E.Languages"}}</h4>
						<ul class="traits-list inline-list">
						{{#if (moblok-hascontents data.traits.languages.selected)}}
							{{#each data.traits.languages.selected as |v k|}}
								<li class="trait-value">{{v}}</li>
							{{/each}}
						{{else}}
							<li class="trait-value">&mdash;</li>
						{{/if}}
						</ul>
					</span>
				</li>
				
				<li class="attribute">
					<span class="attribute-wrapper">
						<h4 class="attribute-name">{{localize "MOBLOKS5E.Challenge"}}</h4>
						<span class="trait-value"
							placeholder="0"
							contenteditable="{{flags.editing}}"
							data-dtype="Number"
							data-field-key="data.details.cr"
							>{{labels.cr}}</span> <span>({{ localize "MOBLOKS5E.XPLabel" xp=data.details.xp.label }})</span>
					</span>
				</li>
			</ul>
		</section>
    </header>

	<main class="main-section{{#if menus.features.visible}} menu-active{{/if}}">
		{{#if flags.editing}}
			{{> menuItem item=menus.features}}
		{{/if}}
	{{#*inline "resource"~}}
		{{#if (or @root.flags.show-resources resource.limit)~}}
		<span class="name-extension">{{~" "~}}
			({{#if @root.flags.show-resources~}}
				<span class="resource-value" 
					placeholder="0" 
					contenteditable="{{@root.owner}}" 
					data-dtype="Number"
					{{#if resource.entity}}
						data-entity="{{resource.entity}}"
					{{/if}}
					data-field-key="{{resource.target}}">{{resource.current}}</span>
				{{~#if resource.limit}}{{localize "MOBLOKS5E.Comma"}} {{/if}}
			{{~/if~}}
			{{~#if resource.limit~}}
				{{#if (eq resource.type "charges")}}
					<span class="resource-value" 
						placeholder="0"
						contenteditable="{{@root.owner}}"
						data-dtype="Number"
						{{#if resource.entity}}
							data-entity="{{resource.entity}}"
						{{/if}}
						data-field-key="{{resource.limTarget}}">{{resource.limit}}</span>
				{{~else~}}
					{{resource.limit}}
				{{~/if~}}
				/{{resource.refresh}}
			{{~/if~}}
			{{#if resource.name}} {{resource.name}}{{/if~}}
			){{~" "~}}
		</span>
		{{~/if}}
	{{~/inline}}
	{{#*inline "featureBlock"}}
	<section class="item monster-feature{{#if legendaryactions}} legendary-actions{{/if}}{{#if lairactions}} lair-actions{{/if}}{{#unless item.flags.monsterblock.expanded}} compact{{/unless}}" title="{{ localize 'MOBLOKS5E.EditHint' }}">
		<div class="feature-description inline-children">
			{{#if flags.show-delete}}
				<a class="delete-item" data-item-id="{{item._id}}">
					<i class="fa fa-trash"></i>
				</a>
			{{/if}}
			{{#unless lairactions}}
				<span class="item-name" data-item-id="{{item._id}}">
					{{~item.name~}} 
				</span>
				
				{{~#if item.data.recharge.value~}}
					<span class="name-extension"
						data-item-id="{{item._id}}"
						data-roll-flavor="{{item.name}} ({{ localize 'MOBLOKS5E.Recharge' }} {{item.data.recharge.value}}-6): " 
						data-roll-formula="1d6" 
						data-roll-target="{{item.data.recharge.value}}" 
						data-roll-success="{{ localize 'DND5E.Charged' }}" 
						data-roll-failure="{{ localize 'MOBLOKS5E.NCharged' }}"
						data-roll-handler="setCharged">
						({{ localize 'MOBLOKS5E.Recharge' }} {{item.data.recharge.value}}-6){{~" "~}}
					</span>
				{{~/if~}}
				{{~#if (and item.is.legendary (gt item.data.activation.cost 1))~}}
					<span class="name-extension">
						({{ localize "MOBLOKS5E.LegActionCost" number=item.data.activation.cost}}){{~" "~}}
					</span>
				{{~/if~}}
				{{~#unless legendaryactions~}}
					{{~#if item.hasresource~}}
						{{> resource resource=item.resource}}
					{{~/if~}}
				{{~/unless~}}{{ localize "MOBLOKS5E.NameDescriptionSep" }}
			{{~else~}}
				<span class="item-name" data-item-id="{{item._id}}"></span>
			{{~/unless}}
			<span class="description">{{{moblok-enrichhtml item.data.description.value @root.owner @root.flags}}}</span>
		</div>
	</section>
	{{/inline}}
	
	
	{{#each features.casting.items as |casting id|}}
	{{#if @root.flags.casting-feature}}
	<section class="item monster-feature spellcasting-trait{{#unless casting.flags.monsterblock.expanded}} compact{{/unless}}" title="{{ localize 'MOBLOKS5E.EditHint' }}">
		<div class="feature-description inline-children">
			{{#if @root.flags.show-delete}}
				<a class="delete-item" data-item-id="{{casting._id}}">
					<i class="fa fa-trash"></i>
				</a>
			{{/if}}
			<span class="item-name" data-item-id="{{casting._id}}">{{casting.name}}</span>.
			{{~#if item.hasresource~}}
				{{> resource resource=item.resource}}
			{{~/if~}}
			<span class="description">
				{{{ casting.description.level }}}
				{{{ casting.description.ability }}}
				{{{ casting.description.stats }}}
				{{{ casting.description.warlockRecharge }}}
				{{{ casting.description.spellintro }}}
			</span>
			<ul class="spell-list">
			{{#each casting.spellbook as |page id|}}
			{{#if page.spells}}
				<li>
					<span class="spell-level-name">
						{{page.label~}}
					</span>
					{{~#if page.slotLabel}}
						<span class="spell-slots">
							({{~#if (and @root.flags.show-resources page.dataset.level)~}}
								<span class="resource-value" 
									placeholder="0"
									contenteditable="{{@root.owner}}"
									data-dtype="Number"
									data-field-key="{{page.slotKey}}.value">
									{{~page.uses~}}
								</span>/
							{{~/if~}}
							{{{page.slotLabel}}}){{~" "~}}
						</span>
					{{~/if~}}
					{{~ localize "MOBLOKS5E.Colon" }}
					<ul class="inline-list spells-level-{{spelllevel.dataset.level}}">
					
					{{#each page.spells as |spell id|}}
							<li class="spell" data-item-id="{{spell._id}}">
								{{#if @root.flags.show-delete}}
									<a class="delete-item" data-item-id="{{spell._id}}">
										<i class="fa fa-trash"></i>
									</a>
								{{/if}}
								<span class="spell-name">{{spell.name}}</span>
								{{~#if spell.hasresource~}}
									{{> resource resource=spell.resource}}
								{{~/if~}}
							</li>
					{{/each}}
					
					</ul>
				</li>
			{{/if}}
			{{/each}}
			</ul>
		</div>
	</section>
	{{else}}
		{{> featureBlock item=casting actor=@root.actor}}
	{{/if}}
	{{/each}}
	

	{{#each features.features.items as |item iid|}}
		{{#unless item.is.specialAction}}
			{{> featureBlock item=item actor=@root.actor flags=@root.flags}}
		{{/unless}}
	{{/each}}

	{{#if features.legResist.items}}
		{{> featureBlock item=features.legResist.items.[0] actor=actor flags=flags}}
	{{/if}}

	<h2 class="section-header" >{{localize "DND5E.ActionPl"}}</h2>
	
	{{#if features.multiattack.items}}
		{{> featureBlock item=features.multiattack.items.[0] actor=actor flags=flags}}
	{{/if}}
	{{#*inline "damageRoll"~}}
		<span class="attack-damage" 
			data-roll-flavor="{{localize 'DND5E.Damage'}}: {{name}}"
			data-roll-formula="{{formula}}">
			{{~text~}}
		</span>
	{{~/inline}}
	{{#each features.attacks.items as |item iid|}}
	{{#unless item.is.specialAction}}
	<section class="item monster-action{{#unless item.flags.monsterblock.expanded}} compact{{/unless}}" title="{{ localize 'MOBLOKS5E.EditHint' }}">
		<div class="attack-description inline-children">
			{{#if @root.flags.show-delete}}
				<a class="delete-item" data-item-id="{{item._id}}">
					<i class="fa fa-trash"></i>
				</a>
			{{/if}}
			<span class="item-name" data-item-id="{{item._id}}">{{item.name}}</span>
			{{~#if item.hasresource~}}
				{{> resource resource=item.resource}}
			{{~/if~}}
			{{ localize "MOBLOKS5E.NameDescriptionSep" }}
			{{#if @root.flags.attack-descriptions}}
			<span class="generated-text">
				<span class="attack-bonus" 
					data-roll-flavor="{{localize 'DND5E.Attack'}}: {{item.name}}" 
					data-roll-formula="1d20 + {{item.tohit}}">
					<span class="attack-type">
						{{~item.description.attackType~}}
						{{localize "MOBLOKS5E.Colon"}}
					</span>
					{{item.description.tohit~}}
				</span>{{ localize "MOBLOKS5E.Comma" }}
				<span>
					{{ item.description.range }}{{ localize "MOBLOKS5E.Comma" }}
					{{ item.description.target }}{{ localize "MOBLOKS5E.FullStop" }}
				</span>
				{{#if item.description.damage.length }}
					<span class="hit-label">
						{{ localize "MOBLOKS5E.AttackHitLabel" }}
					</span>
					{{#each item.description.damage as |part|}}
						{{#unless @first}}
							{{ localize "MOBLOKS5E.MultiDamageAttackConjunctionPlus" }}
						{{/unless}}
						{{> damageRoll text=part.text name=item.name formula=part.formula}}
						{{ localize "MOBLOKS5E.damage" }}
						{{~#if (and @first item.description.versatile)~}}
							{{ localize "MOBLOKS5E.Comma" }}
							{{> damageRoll 
								name=item.name 
								formula=item.description.versatile.formula
								text=( localize "MOBLOKS5E.AttackVersatile"
										damage=item.description.versatile.text
								)
							}}
							{{~#unless @last}}{{ localize "MOBLOKS5E.Comma" }}{{/unless~}}
						{{/if}}
					{{/each}}
				{{/if~}}
			</span>
			{{~/if}}
			{{~#unless (moblok-moretext item.data.description.value) }}{{~localize "MOBLOKS5E.Continue"}}{{/unless~}}
			<span class="description">{{{moblok-enrichhtml item.data.description.value @root.owner @root.flags}}}</span>
		</div>
	</section>
	{{/unless}}
	{{/each}}
	{{#each features.actions.items as |item iid|}}
		{{#unless item.is.specialAction}}
			{{> featureBlock item=item actor=@root.actor flags=@root.flags}}
		{{/unless}}
	{{/each}}
	{{! Reactions }}
	{{#if info.hasReactions}}
		<h2 class="section-header">{{localize "MOBLOKS5E.Reactions"}}</h2>
		{{#each features.reaction.items as |item iid|}}
			{{#if item.is.reaction}}
				{{> featureBlock item=item actor=@root.actor flags=@root.flags}}
			{{/if}}
		{{/each}}
	{{/if}}
	{{! Legendary Actions }}
	{{#if info.hasLegendaryActions}}
		<h2 class="section-header">
			{{localize "DND5E.LegAct"}}
			{{#if flags.show-resources}}
			<span class="header-resource">
				<span class="resource-value"
					placeholder="0"
					contenteditable="{{@root.owner}}"
					data-dtype="Number"
					data-field-key="data.resources.legact.value">
					{{~data.resources.legact.value~}}
				</span> /
				<span class="resource-value"
					placeholder="0"
					contenteditable="{{@root.flags.editing}}"
					data-dtype="Number"
					data-field-key="data.resources.legact.max">
					{{~data.resources.legact.max~}}
				</span>
			</span>
			{{/if}}
		</h2>
		<section>
			<p class="legendary-description">
				{{ localize "MOBLOKS5E.LegendaryText" name=actor.name number=data.resources.legact.max}}
			</p>
			{{#each features.legendary.items as |item iid|}}
				{{#if item.is.legendary }}
				{{#unless item.is.legResist}}
					{{> featureBlock item=item actor=@root.actor legendaryactions=true flags=@root.flags}}
				{{/unless}}
				{{/if}}
			{{/each}}
		</section>
	{{/if}}
	{{#if info.hasLoot}}
		<h2 class="section-header">{{localize "DND5E.Inventory"}}</h2>
		{{#each features.equipment.items as |item iid|}}
			{{> featureBlock item=item actor=@root.actor flags=@root.flags}}
		{{/each}}
	{{/if}}
	{{! Lair Actions }}
	{{#if info.hasLair}}
	{{#if flags.show-lair-actions}}
		<h2 class="section-header">{{ localize "MOBLOKS5E.LairActionsHeading" }}</h2>
		<section>
			<p>{{ localize "MOBLOKS5E.LairText" name=actor.name }}</p>
			<ul>
			{{#each features.lair.items as |item iid|}}
				{{#if item.is.lair}}
				<li>
					{{> featureBlock item=item actor=@root.actor lairactions=true flags=@root.flags}}
				</li>
				{{/if}}
			{{/each}}
			</ul>
		</section>
	{{/if}}
	{{/if}}
	</main>
{{/if}}
</form>
